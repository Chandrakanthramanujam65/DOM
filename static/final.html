<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meet DOM - Your Smart Translator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a202c;
            color: white;
            text-align: center;
            padding: 20px;
        }
        textarea, select, button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: #2d3748;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Meet <span style="color: cyan;">DOM</span> - Your Smart Translator</h1>
        <button onclick="startSpeechRecognition()">üé§ Speak</button>
        <textarea id="text" placeholder="Type or Speak"></textarea><br>
        <button onclick="translateText()">üåç Translate</button>
        <select id="language">
            <option value="en">English</option>
            <option value="te">Telugu</option>
            <option value="hi">Hindi</option>
            <option value="fr">French</option>
            <option value="es">Spanish</option>
            <option value="de">German</option>
            <option value="zh-CN">Chinese</option>
            <option value="ja">Japanese</option>
            <option value="ru">Russian</option>
            <option value="ar">Arabic</option>
            <option value="ko">Korean</option>
            <option value="it">Italian</option>
            <option value="pt">Portuguese</option>
            <option value="tr">Turkish</option>
            <option value="nl">Dutch</option>
            <option value="bn">Bengali</option>
            <option value="ta">Tamil</option>
            <option value="ml">Malayalam</option>
            <option value="gu">Gujarati</option>
            <option value="mr">Marathi</option>
            <option value="pa">Punjabi</option>
        </select><br>
        <div style="background: #4a5568; padding: 15px; border-radius: 10px; margin-top: 10px;">
            <h2>üìú DOM's Translation:</h2>
            <p id="translated"></p>
            <button onclick="speakTranslation()">üîä Speak Translation</button>
            <audio id="audioPlayer" controls style="display:none;"></audio>
        </div>
    </div>
    
    <div class="footer">Brought to you by <strong>Chandrakanth</strong></div>
    
    <script>
        const API_URL = "https://dom-smart-translator-production.up.railway.app"; 

        async function translateText() {
            const text = document.getElementById("text").value;
            const language = document.getElementById("language").value;

            if (!text) {
                alert("Please enter some text to translate!");
                return;
            }

            const url = `${API_URL}/translate?text=${encodeURIComponent(text)}&target_lang=${language}`;
            console.log("Requesting:", url);

            try {
                let response = await fetch(url);
                let data = await response.json();
                console.log("Response:", data);

                if (data.translated_text) {
                    document.getElementById("translated").innerText = data.translated_text;
                } else {
                    alert("Translation failed.");
                }
            } catch (error) {
                console.error("Error in translation:", error);
                alert("Error in translation. Check console.");
            }
        }
        
        async function speakTranslation() {
            const translatedText = document.getElementById("translated").innerText;
            const language = document.getElementById("language").value;

            if (!translatedText) {
                alert("No translation available!");
                return;
            }

            const url = `${API_URL}/speech?text=${encodeURIComponent(translatedText)}&lang=${language}`;
            console.log("Requesting speech:", url);

            try {
                let response = await fetch(url);
                if (!response.ok) throw new Error("Speech generation failed");

                const audioPlayer = document.getElementById("audioPlayer");
                audioPlayer.src = url;
                audioPlayer.style.display = "block";
                audioPlayer.play();
            } catch (error) {
                console.error("Error in speech:", error);
                alert("Error in generating speech. Check console.");
            }
        }

        function startSpeechRecognition() {
            try {
                const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.lang = 'en-US';
                recognition.start();

                recognition.onresult = function(event) {
                    document.getElementById("text").value = event.results[0][0].transcript;
                };

                recognition.onerror = function(event) {
                    alert("Speech recognition error: " + event.error);
                };
            } catch (error) {
                alert("Speech recognition is not supported in this browser.");
            }
        }
    </script>
</body>
</html>
